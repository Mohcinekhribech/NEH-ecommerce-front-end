<div>
  <app-nav-bar></app-nav-bar>
  <div class="max-w-4xl mx-auto">
    <h1 class="text-[#8DB600] text-3xl font-semibold my-4">Checkout :</h1>
    <div
      class="flex justify-between space-x-2 space-y-reverse space-y-4 max-md:flex-col-reverse"
    >
      <form
        #orderForm="ngForm"
        (submit)="save(orderForm)"
        class="w-full border rounded-lg p-4 shadow"
      >
        <div class="grid gap-6 mb-6 md:grid-cols-2">
          <div>
            <label
              for="first_name"
              class="block mb-2 text-sm font-medium text-gray-900 "
              >Prénom</label
            >
            <input
              type="text"
              name="first_name"
              [(ngModel)]="order.firstName"
              id="first_name"
              maxlength="250"
              #firstName="ngModel"
              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 "
              placeholder="John"
              required
            />
            <div
              *ngIf="
                firstName.invalid && (firstName.dirty || firstName.touched)
              "
              class="text-red-500 text-xs"
            >
              <div *ngIf="firstName.errors?.['required']">
                Le prénom est requis.
              </div>
              <div *ngIf="firstName.errors?.['maxlength']">
                Le prénom doit contenir moins de 250 caractères.
              </div>
            </div>
          </div>
          <div>
            <label
              for="last_name"
              class="block mb-2 text-sm font-medium text-gray-900 "
              >Nom de famille</label
            >
            <input
              type="text"
              id="last_name"
              name="last_name"
              [(ngModel)]="order.lastName"
              maxlength="250"
              #lastName="ngModel"
              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 "
              placeholder="Doe"
              required
            />
            <div
              *ngIf="lastName.invalid && (lastName.dirty || lastName.touched)"
              class="text-red-500 text-xs"
            >
              <div *ngIf="lastName.errors?.['required']">
                Le nom de famille est requis.
              </div>
              <div *ngIf="lastName.errors?.['maxlength']">
                Le nom de famille doit contenir moins de 250 caractères.
              </div>
            </div>
          </div>
          <div>
            <label
              for="country"
              class="block mb-2 text-sm font-medium text-gray-900 "
              >Pays</label
            >
            <input
              type="text"
              name="country"
              [(ngModel)]="order.country"
              id="country"
              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 "
              placeholder="Maroc"
              maxlength="250"
              #country="ngModel"
              required
            />
            <div
              *ngIf="country.invalid && (country.dirty || country.touched)"
              class="text-red-500 text-xs"
            >
              <div *ngIf="country.errors?.['required']">
                Le pays est requis.
              </div>
              <div *ngIf="country.errors?.['maxlength']">
                Le pays doit contenir moins de 250 caractères.
              </div>
            </div>
          </div>
          <div>
            <label
              for="zipCode"
              class="block mb-2 text-sm font-medium text-gray-900 "
              >Code Postal</label
            >
            <input
              type="text"
              name="zipCode"
              [(ngModel)]="order.zipCode"
              id="zipCode"
              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 "
              placeholder="80000"
              maxlength="5"
              #zipCode="ngModel"
              required
            />
            <div
              *ngIf="zipCode.invalid && (zipCode.dirty || zipCode.touched)"
              class="text-red-500 text-xs"
            >
              <div *ngIf="zipCode.errors?.['required']">
                Le code postal est requis.
              </div>
              <div *ngIf="zipCode.errors?.['maxlength']">
                Le code postal doit contenir moins de 250 caractères.
              </div>
            </div>
          </div>
        </div>
        <div class="mb-6">
          <label
            for="phone"
            class="block mb-2 text-sm font-medium text-gray-900 "
            required
            >Numéro de téléphone</label
          >
          <input
            type="tel"
            name="phone"
            [(ngModel)]="order.phone"
            id="phone"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 "
            placeholder="0612673256"
            required
            maxlength="250"
            pattern="^[0-9]{10}$"
            #phone="ngModel"
          />
          <div
            *ngIf="phone.invalid && (phone.dirty || phone.touched)"
            class="text-red-500 text-xs"
          >
            <div *ngIf="phone.errors?.['required']">
              Le téléphone est requis.
            </div>
            <div *ngIf="phone.errors?.['pattern']">
              Le téléphone doit contenir 10 chiffres.
            </div>
          </div>
        </div>
        <div class="mb-6">
          <label
            for="email"
            class="block mb-2 text-sm font-medium text-gray-900 "
            >Adresse e-mail</label
          >
          <input
            type="email"
            name="email"
            [(ngModel)]="order.email"
            id="email"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 "
            placeholder="john.doe@company.com"
            maxlength="250"
            pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
            #email="ngModel"
            required
          />
          <div
            *ngIf="email.invalid && (email.dirty || email.touched)"
            class="text-red-500 text-xs"
          >
            <div *ngIf="email.errors?.['required']">L'e-mail est requis.</div>
            <div *ngIf="email.errors?.['pattern']">
              Veuillez entrer une adresse e-mail valide.
            </div>
            <div *ngIf="email.errors?.['maxlength']">
              L'e-mail doit contenir moins de 250 caractères.
            </div>
          </div>
        </div>
        <div class="mb-6">
          <label
            for="city"
            class="block mb-2 text-sm font-medium text-gray-900 "
            >Ville</label
          >
          <input
            type="text"
            name="city"
            [(ngModel)]="order.city"
            id="city"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 "
            placeholder="Casablanca"
            maxlength="250"
            #city="ngModel"
            required
          />
          <div
            *ngIf="city.invalid && (city.dirty || city.touched)"
            class="text-red-500 text-xs"
          >
            <div *ngIf="city.errors?.['required']">La ville est requise.</div>
            <div *ngIf="city.errors?.['maxlength']">
              La ville doit contenir moins de 250 caractères.
            </div>
          </div>
        </div>

        <div class="mb-6">
          <label
            for="address"
            class="block mb-2 text-sm font-medium text-gray-900 "
            >Adresse</label
          >
          <input
            name="address"
            type="text"
            [(ngModel)]="order.address"
            id="address"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 "
            placeholder="Bloc K Nr 321"
            maxlength="250"
            #address="ngModel"
            required
          />
          <div
            *ngIf="address.invalid && (address.dirty || address.touched)"
            class="text-red-500 text-xs"
          >
            <div *ngIf="address.errors?.['required']">
              L'adresse est requise.
            </div>
            <div *ngIf="address.errors?.['maxlength']">
              L'adresse doit contenir moins de 250 caractères.
            </div>
          </div>
        </div>

        <div>
          <label
            for="paymentMethod"
            class="block mb-2 text-sm font-medium text-gray-900 "
            >Méthode de paiement</label
          >
          <div class="card flex justify-start p-2">
            <div class="flex flex-col gap-4">
              <div class="flex items-center">
                <p-radioButton
                  name="paymentMethod"
                  [(ngModel)]="order.paymentMethod"
                  [value]="PaymentMethod.COD"
                  inputId="COD"
                />
                <label
                  for="COD"
                  class="ml-2 flex space-x-1 items-center font-medium"
                >
                  <li class="pi pi-money-bill"></li>
                  <p>Paiement à la livraison</p>
                </label>
              </div>
              <!-- <div class="flex items-center">
                <p-radioButton
                  name="paymentMethod"
                  [(ngModel)]="order.paymentMethod"
                  [value]="PaymentMethod.PAYPAL"
                  inputId="PAYPAL"
                />
                <label
                  for="PAYPAL"
                  class="ml-2 flex space-x-1 items-center font-medium"
                >
                  <li class="pi pi-paypal"></li>
                  <p>Paypal</p>
                </label>
              </div> -->
            </div>
          </div>
        </div>

        <button
          class="bg-[#8DB600] text-white px-2 py-1 rounded-md text-lg my-8 font-semibold w-full"
        >
          Confirmer
        </button>
      </form>

      <div>
        <div class="bg-[#F4F5F8] rounded-lg md:w-[300px] max-md:w-full">
          <div class="flex justify-center p-2 space-x-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon icon-tabler icons-tabler-outline icon-tabler-shopping-bag"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path
                d="M6.331 8h11.339a2 2 0 0 1 1.977 2.304l-1.255 8.152a3 3 0 0 1 -2.966 2.544h-6.852a3 3 0 0 1 -2.965 -2.544l-1.255 -8.152a2 2 0 0 1 1.977 -2.304z"
              />
              <path d="M9 11v-5a3 3 0 0 1 6 0v5" />
            </svg>
            <p class="text-lg font-medium">Panier</p>
          </div>
          <div
            class="w-full border-t-2 border-b-2 py-2 max-h-[50vh] overflow-y-auto"
          >
            <div
              *ngFor="let item of cartItems"
              class="flex p-2 justify-between"
            >
              <img
                class="max-w-[60px] rounded-md"
                [src]="
                  apiUrl+'/upload/'+
                  item.product.productMedias[0].mediaName
                "
                alt=""
              />
              <div>
                <p class="text-sm font-semibold">{{ item.product.name }}</p>
              </div>
              <div>
                <p class="text-sm font-light">
                  {{ item.product.finalPrice }} * {{ item.quantity }}
                </p>
              </div>
            </div>
          </div>
          <div class="p-2 w-full">
            <div class="flex justify-between text-sm">
              <p>Total :</p>
              <p>{{ total }} £</p>
            </div>
            <div class="flex justify-between text-sm">
              <p>TVA 20% :</p>
              <p>{{ total * 0.2 }} £</p>
            </div>
            <div class="flex justify-between text-md">
              <p>Prix TTC :</p>
              <p>{{ ttcPrice }} £</p>
            </div>
          </div>
          <!-- Promo Code Section -->
<div class="mt-6 p-4 border border-gray-200 rounded-lg shadow-sm bg-gray-50">
  <h3 class="text-md font-semibold mb-2 text-gray-700">Have a Promo Code?</h3>
  <div class="flex items-center gap-3">
    <input
      type="text"
      [(ngModel)]="promoCode"
      name="promoCode"
      placeholder="Enter promo code"
      class="w-1/2 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-lime-500"
    />
    <button
      (click)="validatePromoCode()"
      class="px-4 py-2 bg-lime-600 text-white rounded-lg hover:bg-lime-700 font-semibold"
    >
      Apply
    </button>
  </div>

  <div *ngIf="promoError" class="mt-2 text-red-600 text-sm">{{ promoError }}</div>
  <div *ngIf="promoSuccess" class="mt-2 text-green-600 text-sm">Promo code applied! 🎉</div>

  <div *ngIf="discountPercentage" class="mt-4 text-gray-800 font-medium">
    Discount: -{{ discountPercentage }}%
  </div>
</div>

        </div>
      </div>
    </div>
  </div>
</div>
<app-pop-up
  (closeEvent)="closeModal($event)"
  [class]="showPaypal ? '' : 'hidden'"
>
  <div id="paypal-button-container" class="p-8 bg-white"></div>
</app-pop-up>
