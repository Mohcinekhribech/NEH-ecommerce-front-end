<div>
  <app-nav-bar></app-nav-bar>
  <div class="max-w-4xl mx-auto">
    <h1 class="text-[#8DB600] text-3xl font-semibold my-4">Checkout :</h1>
    <div class="flex justify-between space-x-2">
      <form
        #orderForm="ngForm"
        (submit)="save(orderForm)"
        class="w-full border rounded-lg p-4 shadow"
      >
        <div class="grid gap-6 mb-6 md:grid-cols-2">
          <div>
            <label
              for="first_name"
              class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
              >First name</label
            >
            <input
              type="text"
              name="first_name"
              [(ngModel)]="order.firstName"
              id="first_name"
              maxlength="250"
              #firstName="ngModel"
              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
              placeholder="John"
              required
            />
            <div
              *ngIf="
                firstName.invalid && (firstName.dirty || firstName.touched)
              "
              class="text-red-500 text-xs"
            >
              <div *ngIf="firstName.errors?.['required']">
                first name is required.
              </div>
              <div *ngIf="firstName.errors?.['maxlength']">
                first name must be less than 250 characters.
              </div>
            </div>
          </div>
          <div>
            <label
              for="last_name"
              class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
              >Last name</label
            >
            <input
              type="text"
              id="last_name"
              name="last_name"
              [(ngModel)]="order.lastName"
              maxlength="250"
              #lastName="ngModel"
              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
              placeholder="Doe"
              required
            />
            <div
              *ngIf="lastName.invalid && (lastName.dirty || lastName.touched)"
              class="text-red-500 text-xs"
            >
              <div *ngIf="lastName.errors?.['required']">
                last name is required.
              </div>
              <div *ngIf="lastName.errors?.['maxlength']">
                last name must be less than 250 characters.
              </div>
            </div>
          </div>
          <div>
            <label
              for="country"
              class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
              >Country</label
            >
            <input
              type="text"
              name="country"
              [(ngModel)]="order.country"
              id="country"
              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
              placeholder="Morocco"
              maxlength="250"
              #country="ngModel"
              required
            />
            <div
              *ngIf="country.invalid && (country.dirty || country.touched)"
              class="text-red-500 text-xs"
            >
              <div *ngIf="country.errors?.['required']">
                country is required.
              </div>
              <div *ngIf="country.errors?.['maxlength']">
                country must be less than 250 characters.
              </div>
            </div>
          </div>
          <div>
            <label
              for="zipCode"
              class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
              >Code Postal</label
            >
            <input
              type="text"
              name="zipCode"
              [(ngModel)]="order.zipCode"
              id="zipCode"
              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
              placeholder="80000"
              maxlength="5"
              #zipCode="ngModel"
              required
            />
            <div
              *ngIf="zipCode.invalid && (zipCode.dirty || zipCode.touched)"
              class="text-red-500 text-xs"
            >
              <div *ngIf="zipCode.errors?.['required']">
                zip code is required.
              </div>
              <div *ngIf="zipCode.errors?.['maxlength']">
                zip code must be less than 250 characters.
              </div>
            </div>
          </div>
        </div>
        <div class="mb-6">
          <label
            for="phone"
            class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
            required
            >Phone number</label
          >
          <input
            type="tel"
            name="phone"
            [(ngModel)]="order.phone"
            id="phone"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
            placeholder="0612673256"
            required
            maxlength="250"
            pattern="^[0-9]{10}$"
            #phone="ngModel"
          />
          <div
            *ngIf="phone.invalid && (phone.dirty || phone.touched)"
            class="text-red-500 text-xs"
          >
            <div *ngIf="phone.errors?.['required']">phone is required.</div>
            <div *ngIf="phone.errors?.['pattern']">phone must be 10 digits</div>
          </div>
        </div>
        <div class="mb-6">
          <label
            for="email"
            class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
            >Email address</label
          >
          <input
            type="email"
            name="email"
            [(ngModel)]="order.email"
            id="email"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
            placeholder="john.doe@company.com"
            maxlength="250"
            pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
            #email="ngModel"
            required
          />
          <div
            *ngIf="email.invalid && (email.dirty || email.touched)"
            class="text-red-500 text-xs"
          >
            <div *ngIf="email.errors?.['required']">email is required.</div>
            <div *ngIf="email.errors?.['pattern']">
              Please enter a valid email address.
            </div>
            <div *ngIf="email.errors?.['maxlength']">
              email must be less than 250 characters.
            </div>
          </div>
        </div>
        <div class="mb-6">
          <label
            for="city"
            class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
            >City</label
          >
          <input
            type="text"
            name="city"
            [(ngModel)]="order.city"
            id="city"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
            placeholder="Casablanca"
            maxlength="250"
            #city="ngModel"
            required
          />
          <div
            *ngIf="city.invalid && (city.dirty || city.touched)"
            class="text-red-500 text-xs"
          >
            <div *ngIf="city.errors?.['required']">city is required.</div>
            <div *ngIf="city.errors?.['maxlength']">
              city must be less than 250 characters.
            </div>
          </div>
        </div>

        <div class="mb-6">
          <label
            for="address"
            class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
            >Address</label
          >
          <input
            name="address"
            type="text"
            [(ngModel)]="order.address"
            id="address"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
            placeholder="Block K Nr 321"
            maxlength="250"
            #address="ngModel"
            required
          />
          <div
            *ngIf="address.invalid && (address.dirty || address.touched)"
            class="text-red-500 text-xs"
          >
            <div *ngIf="address.errors?.['required']">address is required.</div>
            <div *ngIf="address.errors?.['maxlength']">
              address must be less than 250 characters.
            </div>
          </div>
        </div>

        <div>
          <label
          for="paymentMethod"
          class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
          >Payment Method</label
        >
          <div class="card flex justify-start p-2">
            <div class="flex flex-col gap-4">
              <div class="flex items-center">
                <p-radioButton
                  name="paymentMethod"
                  [(ngModel)]="order.paymentMethod"
                  [value]="PaymentMethod.COD"
                  inputId="COD"
                />
                <label for="COD"  class="ml-2 flex space-x-1 items-center font-medium">
                  <li class="pi pi-money-bill"></li>
                  <p>Cash On Delivery</p>
                </label>
              </div>
              <div class="flex items-center">
                <p-radioButton
                  name="paymentMethod"
                  [(ngModel)]="order.paymentMethod"
                  [value]="PaymentMethod.PAYPAL"
                  inputId="PAYPAL"
                />
                <label for="PAYPAL" class="ml-2 flex space-x-1 items-center font-medium">
                  <li class="pi pi-paypal"></li>
                  <p>Paypal</p>
                </label>
              </div>
            </div>
          </div>
        </div>

        <button
          class="bg-[#8DB600] text-white px-2 py-1 rounded-md text-lg my-8 font-semibold w-full"
        >
          Confirm
        </button>
      </form>
      <div>
        <div class="bg-[#F4F5F8] rounded-lg w-[300px]">
          <div class="flex justify-center p-2 space-x-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon icon-tabler icons-tabler-outline icon-tabler-shopping-bag"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path
                d="M6.331 8h11.339a2 2 0 0 1 1.977 2.304l-1.255 8.152a3 3 0 0 1 -2.966 2.544h-6.852a3 3 0 0 1 -2.965 -2.544l-1.255 -8.152a2 2 0 0 1 1.977 -2.304z"
              />
              <path d="M9 11v-5a3 3 0 0 1 6 0v5" />
            </svg>
            <p class="text-lg font-medium">Panier</p>
          </div>
          <div
            class="w-full border-t-2 border-b-2 py-2 max-h-[50vh] overflow-y-auto"
          >
            <div
              *ngFor="let item of cartItems"
              class="flex p-2 justify-between"
            >
              <img
                class="max-w-[60px] rounded-md"
                [src]="
                  'http://localhost:9090/api/upload/' +
                  item.product.productMedias[0].mediaName
                "
                alt=""
              />
              <div>
                <p class="text-sm font-semibold">{{ item.product.name }}</p>
              </div>
              <div>
                <p class="text-sm font-light">
                  {{ item.product.finalPrice }} * {{ item.quantity }}
                </p>
              </div>
            </div>
          </div>
          <div class="p-2 w-full">
            <div class="flex justify-between text-sm">
              <p>Total :</p>
              <p>{{ total }} $</p>
            </div>
            <div class="flex justify-between text-sm">
              <p>TVA 20% :</p>
              <p>{{ total * 0.2 }} $</p>
            </div>
            <div class="flex justify-between text-md">
              <p>Prix TTC :</p>
              <p>{{ ttcPrice }} $</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<app-pop-up
  (closeEvent)="closeModal($event)"
  [class]="showPaypal ? '' : 'hidden'"
>
  <div id="paypal-button-container" class="p-8 bg-white"></div>
</app-pop-up>